<html>
<head>
<title>opdrachtenh7 en 9</title>
  <link rel=”manifest” href=”manifest.json” />

    <!-- Service Worker registreren -->
		<script>
						window.onload = function(){
                        let but = document.getElementById("submit");
                        let div = document.getElementById("div");
                         let socket = new WebSocket('wss://demos.kaazing.com/echo');
                                    // Bij connectie open:
                                  socket.onopen = function(ev) {
                                    console.log('Verbinding gemaakt!');
                                  };
                                  
                                  // Bij mislukte connectie:
                                  socket.onerror = function(err){
                                    console.log(`Er is iets misgegaan: ${err}`)
                                  }
                        but.addEventListener('click', event  => {
                                    event.preventDefault();
                                    console.log("onload add click");
                                    let content = document.getElementById('invoer').value;
                                    if (content != ''){
                                      socket.send(content);
                                    } else {
                                      alert('Geen bericht ingevoerd');
                                    }
                                    });
                                  // Bij ontvangen van bericht:
                                  socket.onmessage = function(ev) {
                                    let bericht = ev.data;
                                    let item = document.createElement("span");
                                    item.textContent = bericht;
                                    div.appendChild(item);
                                    div.appendChild(document.createElement('br'));
                                    document.getElementById('invoer').value = "";
                                  };
                                  
  
    
    
  };

                                                               
			            
				
			
	/*		dit was h7 in de onload
				if ('serviceWorker' in navigator) {
					navigator.serviceWorker.register('sw.js').then(
						registratie=> {
							console.log(`Registratie gelukt: ${registratie.scope}`);
	
							if ('PushManager' in window){
								console.log("Push berichten worden ondersteund!");						
								
								Notification.requestPermission().then(
									antwoord => {
										if (antwoord === 'default'){
											console.log('Helaas; notificatie verzoek weggeklikt');
											return;
										}
										
										if (antwoord === 'denied'){
											console.log('Helaas; notificaties geweigerd');
											return;
										}
									
										if (antwoord==='granted'){
											console.log('Hoera! We hebben toestemming voor notificaties');
											
											// Check bestaande registratie en maak gebruiker:
											registratie.pushManager.getSubscription().then(
													sub =>{
														if (sub === null) {
															console.log("Er is nog geen geregistreerde Push-gebruiker");
															//maakPushUser(registratie);
														}
													}
											);
										}
									}
								);
							}
						}
					).catch(
						fout=> {
							console.log(`Er is iets foutgegaan: ${fout}`);
						}
					);
					// function maakPushUser(registratie){				   
						// const publicKey = urlBase64ToUint8Array('BO_jVugPTE8AMOQqIGWEPcbJWRKI6nI6IdnH7vLN4_KoPMn9hySs9-w-b4cMytP3Z_YnZeFh2lWqJD2xepMitTY');
						
						// registratie.pushManager.subscribe(
							// {
								// userVisibleOnly: true,
								// applicationServerKey: publicKey
							// }
						// ).then(
							// sub => {
								// updateSubscriptionAtServer(sub);
								// console.log("User geabonneerd op meldingen");
							// }
						// ).catch(
							// fout => {
								// console.log(`Abonneren op notificaties niet gelukt: ${fout}`);
							// }
						// );
					// }
					
					// function updateSubscriptionAtServer(subscriptie){
						// /* Hier schrijven we normaal info naar de server 
						// console.dir(subscriptie);
					// }
					
				}
			}
            */
            
  </script>
</head>
<body>
 <form action="">
   <input id="invoer"type="text" placeholder="dit bericht wordt verstuurd"></input>
   <input id="submit" type="submit">    </input> 
   </form>
   <div id="div"></div>
</body>
</html>

