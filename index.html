<!--nino cmadzic -->
<!DOCTYPE html>
<html>
    <head>
        <title>Random Cat Facts Generator</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#f3a521" />
		<link rel="icon" href="icons/icon-192x192.png" sizes="192x192" />
		<link rel="manifest" href="manifest.json" />
    </head>
    <body>
        <h1>Random Cat Facts</h1>
        <p id="fact"></p>
        <button id="fetch">Get new fact</button>
        <script>
            // #### Data Service classes ####
            class DataService {
                constructor() {
                    if(new.target === DataService) {
                        throw TypeError('This class is abstract.');
                    }
                }

                // Must always return a promise.
                fetchData() {
                    throw new Error('Method not implemented.');
                }
            }

            class CatFactDataService extends DataService {
                #_endpoint = 'https://meowfacts.herokuapp.com/';

                constructor() {
                    super();
                }

                fetchData() {
                    return new Promise((resolve, reject) => {
                        window.fetch(this.#_endpoint)
                        .then(response => response.json())
                        .then(data => resolve(data.data[0]))
                        .catch(err => {
                            reject(err);
                        });
                    });
                }
            }

            class DataServiceFactory {
                static #_services = {
                    'cat-facts': new CatFactDataService()
                }

                static getService(name) {
                    const service = DataServiceFactory.#_services[name];

                    if(!service) {
                        throw new Error(`Service ${name} does not exist.`);
                    }

                    return service;
                }
            }

            // #### Application ####
            (function() {
                _fetchTimeout = 15000;
                _factElem = null;
                _fetchElem = null;

                function display(data) {
                    _factElem.innerText = data[0];
                }

                async function _fetchFact(dataService) {
                    try {
                        const data = await dataService.fetchData();
                        _factElem.innerText = data;
                    } catch(err) {
                        console.error(err);
                        _factElem.innerText = 'Failed to retrieve a cat fact.';
                    }
                }

                function _initServiceWorker() {
                    if('serviceWorker' in navigator) {
                        navigator.serviceWorker
                        .register('sw.js')
                        .then(result => {
                            console.log(`Service Worker registered @ ${result.scope}`);
                        }).catch(err => {
                            console.error('Failed to register Service Worker.', err);
                        });
                    } else {
                        console.error('Browser does not support Service Worker.');
                    }
                }

                function init() {
                    try {
                        _initServiceWorker();

                        _factElem = document.getElementById('fact');
                        _fetchElem = document.getElementById('fetch');
                        const dataService = DataServiceFactory.getService('cat-facts');

                        _fetchElem.addEventListener('click', (e) => {
                            _fetchFact(dataService);
                        });

                        _fetchFact(dataService);
                    } catch(err) {
                        console.error(err);
                        alert('Failed to initialize the application.');
                    }
                }

                window.addEventListener('load', (e) => {
                    init();
                });
            })();
        </script>
    </body>
</html>

<!-- <html>
<head>
<title>intarraytest</title>
  <link rel=”manifest” href=”manifest.json” />
<script>
   window.onload = function(){
         // Service Worker registreren 
     if ('serviceWorker' in window.navigator){
	  window.navigator.serviceWorker.register('sw.js').then(
	    registratie => {
		    console.log(`Registratie gelukt: ${registratie.scope}`);
		    }
	  ).catch(
	   	 fout => {console.log(`Er is iets fout gegaan: ${fout}`)}
	  )
	}
    else {
	console.log('helaas, geen werker')
	}
	
	//input item van change event voorzien
	document.getElementById("cursus").addEventListener('change',
	      function(ev){
		 let cursus_in  = document.getElementById("cursus").value
		 if (cursus_in == null) return;
		 let url="https://www.vijfhart.nl/opleidingen/"
		 url = url||cursus_in
		 fetch(url).then(
			 response => {
		           return  response.text()
			 }
		 ).then(
			 t => {
			 document.getElementById("resultaat").innerHTML = t
			 }
		 ).catch(
		   fout => {
			    console.log(`Ging iets fout: ${fout}`);
			  }
		 )
	     }	
							   
	) // einde toevoeg eventlistener
	} // window onload	
</script>	
</head>
<body>
	<div>kijk in de console</div>
	<label>cursus</label><input type="text" id="cursus"/>
	<div id="resultaat"></div>
</body>
</html> -->

